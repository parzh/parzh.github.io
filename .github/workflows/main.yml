name: Deploy https://parzh.github.io

on:
  push:
    branches: [develop]

jobs:
  test:
    name: Test the source
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2

      - run: npm ci
      - run: npm run compile
      - run: npm test

  deploy:
    name: Put page files to 'master' branch
    runs-on: ubuntu-18.04
    needs: [test]
    steps:
      - uses: actions/checkout@v2

      - name: Install Ruby >= 2.4
        uses: actions/setup-ruby@v1.0.0
        with:
          version: ">= 2.4"

      - name: Install Jekyll
        run: |
          gem install jekyll

      - name: Build local 'master'
        run: |
          git worktree add -f _site master
          jekyll build

      - name: Sync local and remote 'master'
        run: |
          cd _site
          git add --all
          git commit --allow-empty -m "Build from $GITHUB_SHA"
          git push origin master --no-verify
          cd ..
